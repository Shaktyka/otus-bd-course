# Сущности БД

Почти каждая таблица содержит поля dttmcr - дата и время создания записи, dttmup - дата и время изменения записи, dttmcl - дата и время закрытия записи (предполагается, что мы не удаляем записи, а отмечаем их закрытыми).

1. **Группы статусов** (status_groups)

    Справочник групп статусов (для товаров, заказов, пользователей и др.). Используются для удобства работы.

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * *status_group* - название группы
    * _description_ - описание (примечание)

    Данные справочника используются в таблице statuses.

1. **Статусы** (statuses)

    Справочник статусов. Каждый статус имеет ссылку на свою группу.

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * *status_group_id* - идентификатор группы статусов
    * _status_ - статус
    * _description_ - описание (примечание)

    Данные справочника используются в разных таблицах.

1. **Пользователи** (users)
    
    Хранит данные о пользователях (физлицах): покупателях, представителях поставщиков, сотрудниках и т.п. Адрес хранится в формате, отдаваемом сервисом dadata.ru.

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * *last_name* - фамилия пользователя
    * *first_name* - имя пользователя
    * *middle_name* - отчество пользователя
    * *birth_date* - дата рождения 
    * _email_ - email 
    * *password_hash* - хэш пароля md5
    * _address_ - адрес в формате Dadata.ru
    * _phone_ - телефон
    * _gender_ - пол (м,ж)
    * *status_id* - статус (активный, заблокирован, не подтверждён и т.п.)

    Данные используются таблицами orders, suppliers.

1. **Производители** (manufacturers)

    Содержатся данные о производителях кофе и аксессуаров. По сути, это список брендов.

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * _manufacturer_ - название производителя
    * _address_ - адрес в формате Dadata
    * _logo_ - ссылка на логотип
    * _site_ - ссылка на сайт

    Данные справочника используются в таблице products.

1. **Категории товаров** (categories)

    Список категорий и подкатегорий товаров в виде дерева: каждая категория имеет ссылку на своего "родителя". Благодаря этому можно создавать сложную структуру категорий. У товара может быть только одна категория.

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * *parent_id* - ссылка на родительскую категорию (id категории из этой же таблицы)
    * _category_ - название категории
    * _description_ - примечание к категории

    Данные справочника используются сущностями самой таблицы, а также в таблице products.

1. **Валюта** (currency)

    Справочник валют.

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * _currency_ - название валюты
    * _code_ - код валюты
    * *cbr_name* - название в системе CBR
    * _rate_ - ставка

    Данные справочника используются в таблице prices.

1. **Способ оплаты** (pay_methods)

    Справочник способов оплаты товаров.

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * *pay_method* - название способа оплаты 

    Данные справочника используются в таблице orders.

1. **Способ доставки** (ship_methods)

    Справочник способов доставки товаров.

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * *ship_method* - название способа доставки

    Данные справочника используются в таблице orders.

1. **Единицы измеренения** товаров (units)

    Справочник списка единиц измерений товаров: упаковка, штука, граммы и т.п.

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * _unit_ - название единицы измерения

    Данные справочника используются в таблице products.

1. **Параметры товаров** (parameters)

    Справочник характеристик товаров. У каждого товара может быть 0 или больше характеристик.

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * _parameter_ - название параметра

    Данные справочника используются в таблице product_params.

1. **Поставщики** (suppliers)

    Хранит данные о поставщиках товаров от производителей.

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * _supplier_ - название компании поставщика
    * *company_phone* - общий телефон компании
    * *address_full* - полный адрес в формате Dadata 
    * *postal_code* - почтовый индекс из address_full
    * _country_ - страна из address_full
    * _region_ - регион из address_full
    * _city_ - город из address_full
    * _address_ - адрес из address_full
    * *contacts_full* - контакты в формате jsonb (может быть несколько)
    * *manager_id* - идентификатор закреплённого менеджера
    * _site_ text - ссылка на сайт компании
    * _description_ - описание поставщика

    Данные используются в таблице product_params.

1. **Товары** (products)

    Список всех позиций товаров.

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * *vendor_code* - код производителя, артикул
    * _product_ - название товара
    * *manufacturer_id* - идентификатор производителя
    * *supplier_id* - идентификатор поставщика
    * *category_id* - идентификатор категории
    * _photos_ - массив ссылок на фотографии товара
    * _description_ - описание товара
    * *quantity_per_unit* - количество на единицу измерения
    * *units_id* - идентификар единицы измерения товара
    * *units_in_stock* - количество единиц товара в наличии
    * *status_id* - идентификатор статуса

    Данные используются в таблицах order_items, order_history, prices.

1. **"Товар + параметр"** (product_params)

    Определяет связь продукта и характеристики. Для каждой характеристики указываются значения: одно или массив.

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * parameter_id - идентификатор параметра
    * value_int - значение типа целое число
    * value_text - значение типа текст
    * value_numeric - дробное значение
    * value_int_arr - массив целых чисел
    * value_text_arr - массив значений типа текст
    * value_jsonb - значение типа jsonb

1. **Цены** (prices)

    Содержит стоимость продуктов в определённой валюте на дату актуальности.

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * *actual_date* - на какую дату актуален прайс
    * *product_id* - идентификатор продукта
    * _amount_ - количество единиц валюты
    * *currency_id* - идентификатор валюты

1. **Заказы** (orders)

    Содержит заказы пользователей с суммой заказа, способом оплаты, доставки и последним статусом заказа (денормализация для удобства).

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * *order_id* - идентификатор заказа
    * *order_sum* - итоговая сумма заказа
    * *currency_id* - валюта заказа
    * *pay_method_id* - способ оплаты
    * *ship_method* - способ доставки
    * *last_status_id* - статус заказа

    Данные используются в таблице order_items.

1. **Товары в заказе** (order_items)

    Хранит список товаров и их кол-в в заказе пользователя.

    * *order_id* - идентификатор заказа
    * *product_id* - идентификатор продукта
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * _quantity_ - количество позиций товара

1. **История заказов** (order_history)

    Хранит историю смены статусов заказов во времени. Нужна для построения отчётов.

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * *order_id* - идентификатор заказа
    * *status_id* - новый статус заказа

1. **Доставка** (shipping)

    Содержатся данные по доставке для заказов. Предполагаем, что адрес, куда доставить, находится у пользователя в профиле.

    * _id_ - идентификатор записи
    * _dttmcr_ - дата и время создания записи
    * _dttmup_ - дата и время изменения записи
    * _dttmcl_ - дата и время закрытия записи
    * *order_id* - идентификатор заказа
    * *ship_method* - способ доставки
    * *ship_date* - предполагаемая дата доставки
    * *ship_price* - стоимость доставки
    * *currency_id* - идентификатор валюты стоимости доставки
    * _status_ - статус доставки
