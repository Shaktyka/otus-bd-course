# Спрогнозировать рост данных и спроектировать модель хранения и архивации

Формируем документ в котором описываем

1. прогноз по возможному росту базы
1. рост данных
1. рост количества пользователей
1. всплески одновременных соединений
1. описываем возможные угрозы и методы защиты от них
1. предлагаем стратегии бэкапа, репликации, кластеризации

---

## О проекте

QuizGame - сервис корпоративной аттестации сотрудников компании. Предоставляется как дополнительный сервис, подключаемый к установленной CRM-системе. Организации приобретают подписку на CRM-систему и при необходимости могут приобрести данный сервис для регулярной аттестации своих работников. CRM рассчитана на средний и крупный бизнес. Работа с сервисом происходит в браузере.

Менеджеры подразделений создают в сервисе команды из сотрудников и заводят списки квалификационных уровней, аттестацию на которые они предполагают осуществлять. По каждому направлению с помощью специального конструктора создаются тесты с вопросами различных типов. К каждому квалификационному уровню прикрепляются наборы тестов.

Для аттестации сотрудников менеджеры создают "сессии": назначают период, за который сотрудник должен пройти набор квалификационных тестов на определённый уровень. Сотрудник прошёл - квалификация считается выполненной, соответственно, сотрудник может получить повышение или какие-либо бонусы.

Сервис является "асинхронным" в плане того, что менеджерам не нужно отслеживать в каждый конкретный момент отдельные шаги сотрудников, им нужно знать, прошёл человек квалификацию или нет.

## Прогноз по возможному росту базы

Рост базы будет зависеть от способа установки CRM: либо компания ставит CRM и сервис аттестации на свой сервер,либо хостится у нас. Далее буду рассматривать случаи, когда компании хранят данные на наших серверах.

Очевидно, что рост базы будет происходить скачкообразно после подключения сервиса, когда менеджеры начнут заводить тесты для аттестации, создавать сессии для сотрудников, и особенно активно в периоды аттестаций, когда сотрудники начнут решать тесты.

## Рост данных

Поскольку сервис является корпоративным, не предполагается больших объёмов и интенсивной записи данных в принципе, как, например, в сервисе такси, где водителям нужно передавать данные каждые несколько секунд. Количество тестов в базе - это достаточно стабильное число. Основной массив тестов заведут примерно в начале работы с сервисом, а потом контент уже не будет часто меняться. Основная запись данных будет происходить в таблицу запусков тестов и особенно в таблицу фиксации ответов на вопросы тестов во время сессий. Поэтому эти таблицы можно сделать партицированными по годам.

Таблицы не превысят нескольких гигабайт даже за несколько лет.

Допустим следующие предположения по данным:

1. Данные в базе будут в основном тестовыми. Сервис предполагает загрузку изображений, но для взрослых людей основной источник информации - это всё-таки текст.
1. Для каждой квалификации (например, "SQL-девелопер Junior") нужно успешно пройти в среднем 12 тестов.
1. В каждом тесте в среднем по 15 вопросов. Это 180 вопросов по всем тестам.
1. В каждом вопросе в среднем 4 варианта ответов. Это 720 записей.
В принципе, данных на одну квалификацию немного.

## Рост количества пользователей

Поскольку сервис является корпоративным, не предполагается крутой рост количества пользователей.
Количество пользователей будет увеличиваться 1) в периоды подключений сервиса, когда будут активно создаваться тесты, 2) в периоды аттестаций, когда большое количество сотрудников компаний в течение нескольких дней будет часто заходить на сайт. Обычно аттестации проходят в определённые периоды года или же регулярно с интервалами в 3 - 6 месяцев, и в эти периоды стоит ожидать значительное повышение нагрузки.

## Всплески одновременных соединений

Ожидаются в периоды подключений сервиса, когда будут заводить тесты, и в периоды аттестаций. Основная часть пользователей будет заходить в рабочее время.

Организации среднего бизнеса имеют штат сотрудников от 101 до 250 человек.
Крупный бизнес - это компании с количеством сотрудников более 250.

Предположим следующие предположения по подключениям:

1. В периоды аттестаций ежедневно будут заходить 30% сотрудников. Это от 30 до 75 человек для среднего бизнеса и более 75 человек (допустим, 100) для крупного.
1. Среднее время сессии - 40 мин. 
1. За эти 40 мин люди пройдут 2 - 3 теста.
1. Они не будут непрерывно клацать мышкой, действия в барузере будут происходить довольно редко: запустили тест - подумали - отметили ответ/ы - нажали "Отправить".
1. В период аттестаций менеджеры будут запускать отчёты по своим сотрудникам. Допустим, 3 - 4 раза в день.
1. В период заведения тестов будет заходить 3% сотрудников: это от 1 до 7 менеджеров для среднего бизнеса и от 8 до 15 человек для крупного. 
1. Они будут заводить тесты около 4 ч в день. 

## Описываем возможные угрозы и методы защиты от них

Сервис будет изолированным от внешнего интернета, доступ к нему будет из CRM по ссылке. Критических данных, новостей, движений финансов тут нет, поэтому он не особенно интересен в плане взломов и других противоправных дествий, однако безопасность всё равно является важным фактором. 



## Предлагаем стратегии бэкапа, репликации, кластеризации

Масштабирование нагрузки
Нагрузку по чтению можно переложить на реплики 
Отчёты тоже можно переложить на реплики (OLAP)
Бэкапы можно снимать со слейвов
Возм-ть перекл-ния в случае сбоя мастера

