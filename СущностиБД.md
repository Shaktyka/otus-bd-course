# Сущности БД

Почти каждая таблица содержит поля dttmcr - дата и время создания записи, dttmup - дата и время изменения записи, dttmcl - дата и время закрытия записи (предполагается, что мы не удаляем записи, а отмечаем их закрытыми).

## Справочники

Справочники содержат справочную информацию, т.е. данные, которые 1) редко изменяются и 2)  используются другими сущностями для описания своей структуры.

1. **Пользователи** (users)
    
    Хранит данные о пользователях (физлицах): покупателях, представителях поставщиков, сотрудниках и т.п. Адрес хранится в формате, отдаваемом сервисом dadata.ru.

1. **Производители** (manufacturers)

    Содержатся данные о производителях кофе и аксессуаров. По сути, это список брендов.

1. **Категории товаров** (categories)

    Содержится список категорий и подкатегорий товаров в виде дерева: каждая категория имеет ссылку на своего "родителя". Благодаря этому можно создавать сложную структуру категорий. У товара может быть одна категория.

1. **Статусы товаров** (product_statuses)

    Справочник статусов товаров: отсутствует в продаже, снят с производства, ожидается поставка и т.п. 

1. **Валюта** (currency)

    Справочник типов валюты.

1. **Статусы заказов** (order_statuses)

    Справочник статусов заказов: новый, в обработке, отменён, завершён и т.п.

1. **Способ оплаты** (pay_methods)

    Справочник содержит способы оплаты товаров.

1. **Способ доставки** (ship_methods)

    Справочник содержит способы доставки товаров.

1. **Единицы измеренения** товаров (units)

    Справочник содержит список единиц измерений товаров: упаковка, штука, граммы и т.п.

1. **Параметры товаров** (parameters)

    Справочник характеристик товаров. У каждого товара может быть много характеристик.


## Основные таблицы

1. **Поставщики** (suppliers)

    Хранит данные о поставщиках товаров от производителей. Содержат адрес в формате dadata, его раскладку по полям, а также контакты в формате jsonb и ссылку на назначенного менеджера из таблицы пользователей.

1. **Товары** (products)

    Список всех позиций товаров. У каждого товара есть производитель, поставщик, категория, описание, массив ссылок на фотографии, статус, форма выпуска, кол-во единиц в наличии.

1. **Связи "товар + параметр"** (product_params)

    Определяет связь продукта и характеристики. Для каждой характеристики указываются значения: одно или массив.

1. **Цены** (prices)

    Содержит стоимость продуктов в определённой валюте на дату актуальности.

1. **Заказы** (orders)

    Содержит заказы пользователей с суммой заказа, способом оплаты, доставки и последним статусом заказа (для удобства).

1. **Товары в заказе** (order_items)

    Хранит список товаров и их кол-в в заказе пользователя.

1. **История заказов** (связь “заказ + статус”) (order_history)

    Хранит историю смены статусов заказов во времени.
